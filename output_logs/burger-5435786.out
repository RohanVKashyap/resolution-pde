Job started on babel-10-5 at Fri Sep  5 00:24:33 EDT 2025
Job ID: 5435786
GPU information:
Fri Sep  5 00:24:33 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 575.51.03              Driver Version: 575.51.03      CUDA Version: 12.9     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA L40S                    On  |   00000000:4F:00.0 Off |                    0 |
| N/A   25C    P8             31W /  350W |       0MiB /  46068MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA L40S                    On  |   00000000:52:00.0 Off |                    0 |
| N/A   27C    P8             32W /  350W |       0MiB /  46068MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
CUDA devices:
CUDA_VISIBLE_DEVICES: 0,1
/home/rvk
Using device: cuda
[2025-09-05 00:24:38,986][root][INFO] - model:
  _target_: models.ffno.FFNO1D
  in_channels: 1
  out_channels: 1
  factor: 4
  n_modes: 64
  width: 128
  n_layers: 4
  ff_weight_norm: true
  n_ff_layers: 3
  layer_norm: true
  dropout: 0.2
  mode: full
  activation: gelu
  use_grid: true
dataset:
  dataset_params:
    _target_: dataloaders.ks_naive_true_multires.ks_true_multires_markov_dataset
    saved_folder: /data/user_data/rvk/ks/
    viscosity: 0.075
    L: 64.0
    lmax: 8
    et: 5.0
    nte: 51
    nt: 51
    train_s: 2048
    reduced_batch: 1
    reduced_resolution_t: 1
    data_mres_size:
      512: 250
    add_res:
    - 32
    - 64
    - 128
    - 256
    add_res_samples:
      256: 0
      128: 250
      64: 250
      32: 1024
    downsample_from_res: 512
    data_normalizer: true
    normalization_type: simple
    num_samples_max: -1
    eval_dataset_target: dataloaders.ks_naive_markov.ks_markov_dataset
    eval_filename: KS_train_2048.h5
    eval_saved_folder: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51
  resize_to_train: false
  evaluation_type: naive_downsample
  window_size: 15
  original_res: 512
  max_test_resolution: 512
  train_mres: true
  pde: ks
training:
  batch_size: 64
  epochs: 100
  learning_rate: 0.001
  use_normalizer: false
project_name: ${dataset.pde}_${hydra:runtime.choices.model}
checkpoint_dir: checkpoints

Project name: ks_ffno_1d/ffno_1d
Model name: models.ffno.FFNO1D
PDE Dataset: ks
This is True Multi-Resolution Training. Train Resolution is the highest data resolution in the multi-resolution data
---------------------
Creating true multi-resolution KS dataset from /data/user_data/rvk/ks/
Parameters: visc_0.075_L64.0_lmax8_et5.0_nte51_nt51
Using filename pattern: KS_train_2048.h5
Target samples per resolution (from files): {512: 250}
Additional downsampled resolutions: [32, 64, 128, 256]
Target samples per downsampled resolution: {256: 0, 128: 250, 64: 250, 32: 1024}
Will downsample from resolution: 512
Loading KS multi-resolution data from /data/user_data/rvk/ks/
Parameters: visc_0.075_L64.0_lmax8_et5.0_nte51_nt51
Target samples per resolution (from files): {512: 250}
Additional downsampled resolutions: [32, 64, 128, 256]
Target samples per downsampled resolution: {256: 0, 128: 250, 64: 250, 32: 1024}
Will downsample from resolution: 512
Loading resolution 512 from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
  Original data shape for 512: (2048, 51, 512)
  After time reduction: (2048, 51, 512)
  Split 'train' data shape: (1638, 51, 512)
  Subsampled to 200 samples for train split
  Added 10000 sample pairs from resolution 512
Adding downsampled resolutions: [32, 64, 128, 256]
Adding downsampled data from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
  Added 40950 downsampled samples at resolution 32
  Added 10000 downsampled samples at resolution 64
  Added 10000 downsampled samples at resolution 128
  No downsampled samples allocated for train split at resolution 256
Total samples loaded: 70950
Resolution distribution:
  128_downsampled: 10000 samples
  32_downsampled: 40950 samples
  512_file: 10000 samples
  64_downsampled: 10000 samples
Sample x shapes: [(1, 512), (1, 512), (1, 512)]
Sample y shapes: [(1, 512), (1, 512), (1, 512)]
Loading KS multi-resolution data from /data/user_data/rvk/ks/
Parameters: visc_0.075_L64.0_lmax8_et5.0_nte51_nt51
Target samples per resolution (from files): {512: 250}
Additional downsampled resolutions: [32, 64, 128, 256]
Target samples per downsampled resolution: {256: 0, 128: 250, 64: 250, 32: 1024}
Will downsample from resolution: 512
Loading resolution 512 from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
  Original data shape for 512: (2048, 51, 512)
  After time reduction: (2048, 51, 512)
  Split 'val' data shape: (204, 51, 512)
  Using all 204 samples for val split
  Added 10200 sample pairs from resolution 512
Adding downsampled resolutions: [32, 64, 128, 256]
Adding downsampled data from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
  Added 5100 downsampled samples at resolution 32
  Added 1250 downsampled samples at resolution 64
  Added 1250 downsampled samples at resolution 128
  No downsampled samples allocated for val split at resolution 256
Total samples loaded: 17800
Resolution distribution:
  128_downsampled: 1250 samples
  32_downsampled: 5100 samples
  512_file: 10200 samples
  64_downsampled: 1250 samples
Sample x shapes: [(1, 512), (1, 512), (1, 512)]
Sample y shapes: [(1, 512), (1, 512), (1, 512)]
Loading KS multi-resolution data from /data/user_data/rvk/ks/
Parameters: visc_0.075_L64.0_lmax8_et5.0_nte51_nt51
Target samples per resolution (from files): {512: 250}
Additional downsampled resolutions: [32, 64, 128, 256]
Target samples per downsampled resolution: {256: 0, 128: 250, 64: 250, 32: 1024}
Will downsample from resolution: 512
Loading resolution 512 from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
  Original data shape for 512: (2048, 51, 512)
  After time reduction: (2048, 51, 512)
  Split 'test' data shape: (206, 51, 512)
  Using all 206 samples for test split
  Added 10300 sample pairs from resolution 512
Adding downsampled resolutions: [32, 64, 128, 256]
Adding downsampled data from /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
  Added 5100 downsampled samples at resolution 32
  Added 1250 downsampled samples at resolution 64
  Added 1250 downsampled samples at resolution 128
  No downsampled samples allocated for test split at resolution 256
Total samples loaded: 17900
Resolution distribution:
  128_downsampled: 1250 samples
  32_downsampled: 5100 samples
  512_file: 10300 samples
  64_downsampled: 1250 samples
Sample x shapes: [(1, 512), (1, 512), (1, 512)]
Sample y shapes: [(1, 512), (1, 512), (1, 512)]
---------Using simple global normalization---------------
Global statistics: X(mean=0.000633, std=3.322995), Y(mean=0.000660, std=3.389679)

Final dataset sizes:
Train dataset size: 70950
Validation dataset size: 17800
Test dataset size: 17900
<dataloaders.ks_naive_true_multires.ks_true_multires_markov_dataset.<locals>.SimpleNormalizedDataset object at 0x1550501ac2d0>
Created resolution groups:
  Resolution 512: 10000 samples
  Resolution 32: 40950 samples
  Resolution 64: 10000 samples
  Resolution 128: 10000 samples
Created resolution groups:
  Resolution 512: 10200 samples
  Resolution 32: 5100 samples
  Resolution 64: 1250 samples
  Resolution 128: 1250 samples
Created resolution groups:
  Resolution 512: 10300 samples
  Resolution 32: 5100 samples
  Resolution 64: 1250 samples
  Resolution 128: 1250 samples
<class 'torch.Tensor'> -0.01135927066206932 -0.014895916916429996 0.977963924407959 0.982454776763916
FFNO1D(
  (in_proj): WNLinear(in_features=1, out_features=128, bias=True)
  (fourier_layers): ModuleList(
    (0-3): 4 x FSpectralConv1d(
      (fourier_weight): ParameterList(  (0): Parameter containing: [torch.float32 of size 128x128x64x2 (cuda:0)])
      (backcast_ff): FeedForward(
        (layers): ModuleList(
          (0): Sequential(
            (0): Linear(in_features=128, out_features=512, bias=True)
            (1): Dropout(p=0.2, inplace=False)
            (2): GELU(approximate='none')
            (3): Identity()
          )
          (1): Sequential(
            (0): Linear(in_features=512, out_features=512, bias=True)
            (1): Dropout(p=0.2, inplace=False)
            (2): GELU(approximate='none')
            (3): Identity()
          )
          (2): Sequential(
            (0): Linear(in_features=512, out_features=128, bias=True)
            (1): Dropout(p=0.2, inplace=False)
            (2): Identity()
            (3): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          )
        )
      )
    )
  )
  (out_proj): WNLinear(in_features=128, out_features=1, bias=True)
)
Total Model Parameters: 9.97M
Trainable Parameters: 9.97M
Epoch 0, Train Loss: 0.28605789, Val Loss: 0.16178807
Epoch 10, Train Loss: 0.13727118, Val Loss: 0.08568137
Epoch 20, Train Loss: 0.11677089, Val Loss: 0.09507789
Epoch 30, Train Loss: 0.10422712, Val Loss: 0.08978860
Epoch 40, Train Loss: 0.09536535, Val Loss: 0.08845639
Epoch 50, Train Loss: 0.08901345, Val Loss: 0.08747775
Epoch 60, Train Loss: 0.08386527, Val Loss: 0.08784303
Epoch 70, Train Loss: 0.08040508, Val Loss: 0.08681953
Epoch 80, Train Loss: 0.07783724, Val Loss: 0.08685414
Epoch 90, Train Loss: 0.07648471, Val Loss: 0.08607205
Test L2 Loss: 0.082559
Model saved to checkpoints/ffno1d/ks_5435786.pt
Created/verified figures directory: figures/5435786
Evaluating KS model at multiple resolutions
Using normalizer from training resolution 512
Testing resolutions: [32, 64, 128, 256, 512]
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (2048, 51, 512)
Time data shape: (2048, 51)
Original spatial coordinates shape: (512,)
dx shape: (2048,)
dt shape: (2048,)
Data shape after downsampling: (2048, 51, 32)
Final data shape: (2048, 51, 32)
x shape: torch.Size([102400, 1, 32])
y shape: torch.Size([102400, 1, 32])
spatial coordinates shape: (32,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_valid.h5
Available data keys in 'valid': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 32)
Final data shape: (256, 51, 32)
x shape: torch.Size([12800, 1, 32])
y shape: torch.Size([12800, 1, 32])
spatial coordinates shape: (32,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_test.h5
Available data keys in 'test': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 32)
Final data shape: (256, 51, 32)
x shape: torch.Size([12800, 1, 32])
y shape: torch.Size([12800, 1, 32])
spatial coordinates shape: (32,)
Train dataset size: 102400
Validation dataset size: 12800
Test dataset size: 12800
Selected random indices for plotting: [5782, 1504, 11648, 4373, 7985, 2618, 2332, 8609, 178, 9879]
Collected 10 examples for resolution 32
Resolution 32 (downsample factor: 16) - Relative L2 Loss: 0.214634
Memory cleaned after resolution 32


Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (2048, 51, 512)
Time data shape: (2048, 51)
Original spatial coordinates shape: (512,)
dx shape: (2048,)
dt shape: (2048,)
Data shape after downsampling: (2048, 51, 64)
Final data shape: (2048, 51, 64)
x shape: torch.Size([102400, 1, 64])
y shape: torch.Size([102400, 1, 64])
spatial coordinates shape: (64,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_valid.h5
Available data keys in 'valid': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 64)
Final data shape: (256, 51, 64)
x shape: torch.Size([12800, 1, 64])
y shape: torch.Size([12800, 1, 64])
spatial coordinates shape: (64,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_test.h5
Available data keys in 'test': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 64)
Final data shape: (256, 51, 64)
x shape: torch.Size([12800, 1, 64])
y shape: torch.Size([12800, 1, 64])
spatial coordinates shape: (64,)
Train dataset size: 102400
Validation dataset size: 12800
Test dataset size: 12800
Collected 10 examples for resolution 64
Resolution 64 (downsample factor: 8) - Relative L2 Loss: 0.142584
Memory cleaned after resolution 64


Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (2048, 51, 512)
Time data shape: (2048, 51)
Original spatial coordinates shape: (512,)
dx shape: (2048,)
dt shape: (2048,)
Data shape after downsampling: (2048, 51, 128)
Final data shape: (2048, 51, 128)
x shape: torch.Size([102400, 1, 128])
y shape: torch.Size([102400, 1, 128])
spatial coordinates shape: (128,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_valid.h5
Available data keys in 'valid': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 128)
Final data shape: (256, 51, 128)
x shape: torch.Size([12800, 1, 128])
y shape: torch.Size([12800, 1, 128])
spatial coordinates shape: (128,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_test.h5
Available data keys in 'test': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 128)
Final data shape: (256, 51, 128)
x shape: torch.Size([12800, 1, 128])
y shape: torch.Size([12800, 1, 128])
spatial coordinates shape: (128,)
Train dataset size: 102400
Validation dataset size: 12800
Test dataset size: 12800
Collected 10 examples for resolution 128
Resolution 128 (downsample factor: 4) - Relative L2 Loss: 0.021842
Memory cleaned after resolution 128


Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (2048, 51, 512)
Time data shape: (2048, 51)
Original spatial coordinates shape: (512,)
dx shape: (2048,)
dt shape: (2048,)
Data shape after downsampling: (2048, 51, 256)
Final data shape: (2048, 51, 256)
x shape: torch.Size([102400, 1, 256])
y shape: torch.Size([102400, 1, 256])
spatial coordinates shape: (256,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_valid.h5
Available data keys in 'valid': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 256)
Final data shape: (256, 51, 256)
x shape: torch.Size([12800, 1, 256])
y shape: torch.Size([12800, 1, 256])
spatial coordinates shape: (256,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_test.h5
Available data keys in 'test': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 256)
Final data shape: (256, 51, 256)
x shape: torch.Size([12800, 1, 256])
y shape: torch.Size([12800, 1, 256])
spatial coordinates shape: (256,)
Train dataset size: 102400
Validation dataset size: 12800
Test dataset size: 12800
Collected 10 examples for resolution 256
Resolution 256 (downsample factor: 2) - Relative L2 Loss: 0.021773
Memory cleaned after resolution 256


Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_train_2048.h5
Available data keys in 'train': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (2048, 51, 512)
Time data shape: (2048, 51)
Original spatial coordinates shape: (512,)
dx shape: (2048,)
dt shape: (2048,)
Data shape after downsampling: (2048, 51, 512)
Final data shape: (2048, 51, 512)
x shape: torch.Size([102400, 1, 512])
y shape: torch.Size([102400, 1, 512])
spatial coordinates shape: (512,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_valid.h5
Available data keys in 'valid': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 512)
Final data shape: (256, 51, 512)
x shape: torch.Size([12800, 1, 512])
y shape: torch.Size([12800, 1, 512])
spatial coordinates shape: (512,)
Loading from file: /data/user_data/rvk/ks/res_512/visc_0.075_L64.0_lmax8_et5.0_nte51_nt51/KS_test.h5
Available data keys in 'test': ['dt', 'dx', 'pde_51-512', 't', 'x']
Original PDE data shape: (256, 51, 512)
Time data shape: (256, 51)
Original spatial coordinates shape: (512,)
dx shape: (256,)
dt shape: (256,)
Data shape after downsampling: (256, 51, 512)
Final data shape: (256, 51, 512)
x shape: torch.Size([12800, 1, 512])
y shape: torch.Size([12800, 1, 512])
spatial coordinates shape: (512,)
Train dataset size: 102400
Validation dataset size: 12800
Test dataset size: 12800
Collected 10 examples for resolution 512
Resolution 512 (downsample factor: 1) - Relative L2 Loss: 0.021774
Memory cleaned after resolution 512


Creating prediction vs target plots...
Saved prediction plot: figures/5435786/prediction_plots/ks_predictions_vs_targets_10_examples.png
Saved numerical results: figures/5435786/ks_1d_evaluation_results_20250905_004537.csv
Saved summary: figures/5435786/ks_1d_evaluation_summary_20250905_004537.txt

==================================================
KS EVALUATION SUMMARY
==================================================
Resolution  32: 0.214634
Resolution  64: 0.142584
Resolution 128: 0.021842
Resolution 256: 0.021773
Resolution 512: 0.021774

Summary of Super-Resolution Evaluation:
Resolution factor 32: Relative L2 Loss = 0.214634
Resolution factor 64: Relative L2 Loss = 0.142584
Resolution factor 128: Relative L2 Loss = 0.021842
Resolution factor 256: Relative L2 Loss = 0.021773
Resolution factor 512: Relative L2 Loss = 0.021774

Evaluation plots saved to: figures/5435786
Wandb run: https://wandb.ai/rohanvk-carnegie-mellon-university/ffno1d/runs/rmyi7212
Job completed at Fri Sep  5 00:45:42 EDT 2025
